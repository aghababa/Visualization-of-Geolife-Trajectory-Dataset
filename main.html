<html>
<head>
    <meta charset=utf-8/>
    <title>Polylines</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet'/>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>

<div id='map'></div>

<script>
    d3.dsv(",", "20081023025304.plt").then(function (data) {
        mapboxgl.accessToken = "pk.eyJ1IjoiYXVzdGlud2F0a2lucyIsImEiOiJja2hiaW00c3AwMDNwMnBtbXNzbm82aGkyIn0.JomTNPP-9_2Z7E3XGxcCeA";

        var map = new mapboxgl.Map({
            container: "map",
            style: "mapbox://styles/mapbox/streets-v11",
            center: [116.4074, 39.9042],
            zoom: 11
        });

        var container = map.getCanvasContainer();
        var svg = d3
            .select(container)
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .style("position", "absolute")
            .style("z-index", 2);

        function project(d) {
            return map.project(new mapboxgl.LngLat(+d.lon, +d.lat));
        }

        var paths = svg.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "steelblue")
            .attr("stroke-width", 1.5)


        function render() {
            paths
                .attr("d", d3.line()
                    .x(function (d) {
                        // return x(d.date)
                        return project(d).x;
                    })
                    .y(function (d) {
                        // return y(d.value)
                        // todo: make sure my lat on lon are correct
                        return project(d).y;
                    })
                )
        }

        map.on("viewreset", render);
        map.on("move", render);
        map.on("moveend", render);
        render(); // Call once to render
    });
</script>

</body>
</html>

